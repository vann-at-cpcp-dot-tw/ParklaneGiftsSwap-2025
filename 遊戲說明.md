# 虛實整合的交換禮物遊戲（實體交換 + 線上留言板）

## 遊戲介紹
此遊戲是一個交換禮物的遊戲，但是要記錄每個參加者送出的禮物描述，以及收到禮物的心得，並且將這些內容放在一個線上留言板中，讓所有參加者都可以瀏覽，其中在某些步驟由於體驗的關係，資料會故意避免呈現在頁面中，而是透過熱感應列表機印出來給參加者查看

### 實體部分
  1. 一個櫃子總共有 30 格禮物格，第一輪工作人員會預先在每一格放入預設禮物，此後開始皆為參加者互相交換
  2. 參加者必須自備禮物，並且透過程式隨機抽取一個禮物格，將自己的禮物與該格目前的禮物交換，由於是一進一出，所以每個格子都一定會有禮物
  3. 參加者在抽到禮物格後，會由現場的熱感應式列表機，印出該禮物格「上一個」放入該格禮物的人的表單內容，讓當前參加者可以知道自己抽到的禮物是誰送出的，以及該送出者對自己送出禮物的描述

### 線上部分
  1. 參加者需要先通過動態驗證碼的審核，才能進入表單頁面開始遊戲

  2. 表單頁面包括：抽禮物格號的按鈕（1-30）、心裡測驗、對自己送出的禮物的描述、對收到的禮物的心得

  3. 心裡測驗會按照結果，將使用者的禮物分成 A、B、C 類，使用者在按下「抽禮物」時，可以選擇要抽和自己相同類型的禮物還是隨機抽取，這樣的設計是希望讓使用者可以有機會抽到和自己類型相同的禮物，增加遊戲的趣味性

  2. 參加者抽到禮物格後，現場會有一個熱感應列表機，會印出「上一個」放入該格禮物的人的表單內容，當前參加者可以將格內禮物拿出，將自己的禮物放進去，這個列印機制，其實只是留言板裡面的內容列印出來而已

  3. 留言板頁面會顯示參加者送出的禮物描述與收到的禮物心得，讓其他參加者可以瀏覽，但是這遊戲的核心樂趣是「知道別人對自己送出禮物有什麼評價」，所以每個參加者會有一個唯一流水號，在留言板裡面，應該要可以搜尋流水號號，然後看到別人對該編號禮物的評價

  4. 留言板的 UI 可能會以格子呈現，每個格子會顯示該格禮物的送出描述與收到心得，如同上述，禮物是一進一出，所以每個格子都會有屬於該格自己的 log

### 防駭機制
  1. 參加者在會場中掃描活動 QR code，會進入一個填寫「動態驗證碼」的頁面，該驗證頁面只有一個 input，一旁工作人員有一個專屬的裝置，可以呈現類似 Google Authenticator 的動態驗證碼，此驗證碼希望能夠通用化設計，讓工作人員可以將驗證碼登入到 Google Authenticator App，並在 App 內即時查閱，工作人員協助告知參加者目前的驗證碼是多少，參加者填寫後，進入表單頁

  2. 在進入表單頁面後，系統會根據當前 DB 記錄，自動派發流水號，前端將流水號記錄在 cookie 當中，參加者在送出表單時，必須帶上該流水號，後端系統會驗證該流水號是否有效，才能接受表單送出

  3. 遊戲重要流程採用無獨立網址的設計，只依賴前端 state 來驅動畫面，避免使用者可以操作瀏覽器的上一頁

  4. 無論何時，參加者要是不小心斷網、重新整理網頁，state 都會重新開始，都要重新填寫一次動態驗證碼，意思是，動態驗證碼管理是否能夠進入頁面，流水號管理是否能夠送出表單

## 流程
1. 現場多人排隊，但是只有一個人可以進入禮物交換區域
2. 進入區域後，參加者掃描活動 QR code，進入動態驗證碼填寫頁面
3. 工作人員告知參加者當前的動態驗證碼，參加者輸入驗證碼通過後，系統核發流水號（存入 cookie），同時頁面 state 改變畫面呈現出表單畫面，表單頁面包括：
   - 禮物描述欄位（參加者描述自己送出的禮物）
   - 禮物心得欄位（參加者描述自己收到的禮物）
   - 心理測驗題目（根據結果將參加者分成 A、B、C 類）
   - 抽禮物格號按鈕（讓參加者選擇：「要抽自己同類型的禮物」、「不要抽跟自己同類型的禮物」、「隨機」）
     - 注意：此處讓使用者選擇抽禮物類型的設計，只是「優先」的概念，舉例：如果使用者選擇要抽自己同類型的禮物，但是目前所有該類型的禮物格都已經被抽完了，系統就會改為隨機抽取
   - 送出表單按鈕
3.1 在按下「送出表單前」，參加者必須先按下「抽禮物格號按鈕」，，當產生抽號結果時，不會顯示畫面給參加者看，但是前端程式會告訴後端主機「目前有一個列印任務」

3.2. 列表機電腦不斷輪詢後端主機「目前是否有列印任務」，當有的話，即印出剛剛參加者的抽號結果，由於參加者是抽禮物格號，因此根據上述禮物格會有自己的 log，所以列印內容會是「上一個放入該格禮物的參加者」所填寫的表單內容，包括：該參加者的唯一編號、該參加者對自己送出禮物的描述

4. 參加者對照印表機紙上的內容，才知道自己抽到那個禮物格，並且將自己的禮物放入抽到的禮物格，也將該格內的禮物拿出

5. 工作人員引導參加者打開禮物，並完成禮物心得欄位後，按下送出表單按鈕

6. 參加者離開禮物交換區域，下一位參加


## 重點評估
1. DB 設計：格子有會有自己的歷程，然後收/送禮物的參加者要能夠在留言板頁面依靠編號搜尋到自己的禮物評價，也能夠瀏覽其他格子的禮物評價，並且由於每個參加者會根據心裡測驗結果來將禮物分類，是否要用多個表來關聯？

2. 審核機制設計，避免參加者離開現場後，仍然可以透過瀏覽記錄重複進入表單填寫，還是無需避免這件事？ 因為流水號寫入 cookie，而系統只會允許尚未填寫完成表單的流水號送出表單，這樣是否足夠？

3. 目前的流程設計，如果同時併發會發生什麼？ 流水號的核發是否會有問題？ 抽禮物格號的按鈕是否會有問題？ 列表機的列印任務是否會有問題？

4. 由於是現場實體活動，併發應該不會很接近，是否有流水號 + cookie 的設計，現場需要刻意限制不能同時進入表單填寫嗎？

3. 熱感應列表機(epson tm-t82III)的機制該如何設計？ 該列表機無法連網，是否需要連接一台電腦，持續輪詢 DB，查看目前是否有列印任務？

4. 失敗處理機制，假設參加者在填寫表單過程中，突然斷線，或者是列表機缺紙，該如何處理？

5. 由於列表機只是負責印製「上一個」放入該格禮物的人的表單內容，所以缺紙應該不會影響遊戲，重印就好，是否應該設計一個重印按鈕？ 給工作人員使用？

6. 前端會採用 next.js 實作，後端不確定要用無頭 wordpress 好，還是用 Google sheet 好？