# 虛實整合的交換禮物遊戲（實體交換 + 線上留言板）

## 遊戲介紹
此遊戲是一個交換禮物的遊戲，但是要記錄每個參加者送出的禮物描述，其中某些步驟由於體驗的關係，資料會故意避免呈現在頁面中，而是透過熱感應列表機印出來給參加者查看

### 實體部分
  1. 一個櫃子總共有 30 格禮物格，第一輪，工作人員會預先在每一格放入預設禮物，此後開始皆為參加者互相交換
  2. 參加者必須自備禮物，並且透過程式隨機抽取一個禮物格，將自己的禮物與該格目前的禮物交換，由於是一進一出，所以每個格子都一定會有禮物
  3. 參加者在抽到禮物格後，會由現場的熱感應式列表機，印出該禮物格「上一個」人的表單內容

### 線上部分
  1. 此網頁只允許現場 iPad 進入，為避免參加者偷記網址，所以：
  - 整個遊戲採用無獨立網址的設計，所有畫面（step）皆由前端 state 控制
  - 首頁進入後，需要先填寫驗證碼，並通過 api/validate 的審核，才能進入表單頁面開始遊戲

  2. 表單頁面包括：
  - 顯示目前的流水號（自己是第幾號參加者）
  - 六題心裡測驗決定禮物屬於什麼類型
  - 20 字留言
  - 抽禮物的按鈕

  3. 心裡測驗會按照結果，將使用者的禮物分成 A、B、C 類，填完心裡測驗和 20 字留言後，使用者可以選擇要：「抽和自己相同類型的禮物」、「避免抽到和自己相同類型的禮物」還是「隨機抽取」
  - 此處的「要不要抽到自己相同類型的禮物」只是一個「優先」的概念，舉例：如果使用者選擇要抽自己同類型的禮物，但是目前所有該類型的禮物格都已經被抽完了，系統就會改為隨機抽取

  2. 參加者按下抽選禮物後，系統雖以知道抽選結果的格號，但是不會顯示在頁面上，而是現場會有一個熱感應列表機，印出「上一個」放入該格禮物的人的表單內容，當前參加者可以將格內禮物拿出，將自己的禮物放進去，完成了這樣的一輪流程，等於完成了一次「交換」禮物

  4. 遊戲各頁面（step）採用無獨立網址的設計，只依賴前端 state 來驅動畫面，避免使用者可以操作瀏覽器的上一頁

  5. 可能會有多台 iPad 同時進入遊戲，系統需要考慮併發的情況，但由於是實體活動，並不會有太高的併發量

## 流程
1. 現場多人排隊進入交換禮物區操作 iPad (活動頁面)，可能會有一台或多台 iPad
3. 工作人員替參加者的 iPad 輸入 api/validate 審核碼，同時頁面 state 改變畫面呈現出表單畫面，表單頁面包括：
  - 顯示目前的流水號（自己是第幾號參加者）
  - 六題心裡測驗決定這份禮物屬於什麼分類
  - 20 字留言
  - 三個抽禮物的按鈕：「抽和自己相同類型的禮物」、「避免抽到和自己相同類型的禮物」還是「隨機抽取」

4. 當按下「抽禮物格按鈕」時，前端系統會根據心裡測驗，得知使用者的禮物類型，並根據 DB 當前的記錄（30個禮物格裡面，分別有什麼禮物），決定要抽哪一格禮物，但是抽號結果不會顯示在畫面給參加者看，而是透過熱感應機列印出結果

5. 參加者對照印表機紙上的內容，才知道自己抽到那個禮物格，並且將自己的禮物放入抽到的禮物格，也將該格內的禮物拿出

6. 工作人員按下畫面中的「完成交換」按鈕，將這次的記錄寫入進 DB

5. 參加者離開禮物交換區域，下一位參加


## 健壯性評估

1. DB 該如何設計？ 每個格子應該會有自己的 log，否則如何知道目前每個格子分別是什麼禮物？ 並且如何列印出「上一個」放入該格禮物的人的表單內容？ 是否要用多個表來關聯？

2. 列表機型號為：(epson tm-t82III)，該列表機無法連網，是否需要連接一台電腦，持續輪詢 DB，查看目前是否有列印任務？

3. 如上述，即使列印出結果，但其實還是不能保證流程並已經完成，我們應該不能在這時候寫入 DB？ 考慮到使用者可能突然反悔走人，其實禮物並沒有完成與上一個人的交換，必須等到確認禮物已經入格，才由工作人員按下「完成交換」按鈕，才更新 DB

5. 由於列表機只是負責印製「上一個」放入該格禮物的人的表單內容，所以缺紙應該不會影響遊戲，重印就好，是否應該設計一個重印按鈕？ 給工作人員使用？

6. 前端會採用 next.js 實作（就是目前的專案），後端不確定要用無頭 wordpress 好（個人有無頭 wordpress 的部署經驗），還是乾脆用 Google sheet 好？ 甚至乾脆就這個專案直接接 DB? 但是 next.js 有 DB 函數庫套件嗎？ 難道要全部寫 SQL 語法嗎？